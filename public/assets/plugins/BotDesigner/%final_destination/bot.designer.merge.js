var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;MutationObserver||alert("不支援MutationObserver");var DDK={active:function(){DDK.Mutual.init(),DDK.OptionsUICaptain.init(),DDK.ModuleKit.init(),DDK.Mutual.SyncTask.activateSyncTask()},Mutual:{},ModuleKit:{},DataExport:{},DataImport:{},Equalizer:{}};function deployTemplate(a){DDK.OptionsUICaptain.switchModule(a)}DDK.Mutual={ConstantStatic:{SYNC_INTERVAL:50},DynamicValue:{syncTaskArray:null,run_syncTask:null},EventType:{ConstantStatic:{CLICK:"click",RADIO_CHANGE:"change"}},init:function(){DDK.Mutual.DynamicValue.syncTaskArray=[],FxAddEventListener($(".exportDataBtn")[0],"click",function(a){var t=$('input[name="template-type"]:checked').val();if(null!=t){if(1==confirm('即將以AJAX 送出編輯內容,按下"是"就送出!!')){var e=new FormData;if(e.append("templateType",t),"TextModule"==t)e.append("jsonValue",DDK.DataExport.TextModule.exportJSON(".TextModule"));else if("ImageModule"==t)e.append("jsonValue",DDK.DataExport.ImageModule.exportJSON(".ImageModule"));else if("ImageCardsModule"==t){e.append("jsonValue",DDK.DataExport.ImageCardsModule.exportJSON(".ImageCardsModule"));for(var n=$("."+t+' .propsWrapper[data-io="1"] input[type="file"]'),i=0;i<n.length;i++)e.append($(n[i]).attr("name"),n[i].files[0])}else if("FancyCardsModule"==t){e.append("jsonValue",DDK.DataExport.FancyCardsModule.exportJSON(".FancyCardsModule"));for(n=$("."+t+' .propsWrapper[data-io="1"] input[type="file"]'),i=0;i<n.length;i++)e.append($(n[i]).attr("name"),n[i].files[0])}postData(e)}}else alert("至少要選一種樣板編輯完成!")},!1)},fireData:function(a){},stopMe:function(){null!=DDK.Mutual.DynamicValue.run_syncTask&&clearInterval(DDK.Mutual.DynamicValue.run_syncTask)},SyncTask:{addTask:function(a){DDK.Mutual.DynamicValue.syncTaskArray.push(a)},activateSyncTask:function(){if(0<DDK.Mutual.DynamicValue.syncTaskArray.length)for(var a=0;a<DDK.Mutual.DynamicValue.syncTaskArray.length;a++)DDK.Mutual.DynamicValue.syncTaskArray[a]();DDK.Mutual.DynamicValue.run_syncTask=setInterval(function(){if(0!=DDK.Mutual.DynamicValue.syncTaskArray.length)for(var a=0;a<DDK.Mutual.DynamicValue.syncTaskArray.length;a++)1==Boolean(Number($(DDK.Mutual.DynamicValue.syncTaskArray[a].sourceRoot).attr("data-io")))&&DDK.Mutual.DynamicValue.syncTaskArray[a].equalFunc()},DDK.Mutual.ConstantStatic.SYNC_INTERVAL)}},TextScript:{OPEN_LABEL_URL:'是否要開啟這個網址?若您的網址在訊息在Line 推播前有需要保密,請按"取消".'}},DDK.OptionsUICaptain={ConstantStatic:{TEMPLATE_TEXT_MODULE:"fancyTextFull",TEMPLATE_IMAGE_MODULE:"soloMsgImageFull",TEMPLATE_IMAGE_CARDS_NUMBERS_BTN:"imageCardsNumbersButton",IMAGE_CARDS_NUMBERS_COUNTS:10,TEMPLATE_IMAGE_CARDS_SINGLE_CARD:"imageCardsSingleCard",TEMPLATE_IMAGE_CARDS_MODULE:"imageCardsFull",TEMPLATE_FANCY_CARDS_NUMBERS_BTN:"fancyCardsNumbersButton",FANCY_CARDS_NUMBERS_COUNTS:10,TEMPLATE_FANCY_CARDS_OPTIONS_BTN:"FancyCardsOptionsButton",TEMPLATE_FANCY_CARDS_ACTIONS_MIRROR_TARGET:"FancyCardsActionsMirrorTarget",TEMPLATE_FANCY_CARDS_ACTIONS_SETTING_BUTTON:"FancyCardsActionsSettingButton",TEMPLATE_FANCY_CARDS_SINGLE_CARD:"FancyCardsSingleCard",TEMPLATE_FANCY_CARDS_MODULE:"fancyCardsFull",MODULE_WRAPPER_CLASS_NAME:"webBotDesigner"},DynamicValue:{botApp:null,FancyCardsModuleReady:null,ImageCardsModuleReady:null,ImageModuleReady:null,TextModuleReady:null},init:function(){DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_TEXT_MODULE=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_TEXT_MODULE).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_MODULE=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_MODULE).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_NUMBERS_BTN=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_NUMBERS_BTN).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_SINGLE_CARD=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_SINGLE_CARD).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_MODULE=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_MODULE).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_NUMBERS_BTN=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_NUMBERS_BTN).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_OPTIONS_BTN=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_OPTIONS_BTN).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_ACTIONS_MIRROR_TARGET=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_ACTIONS_MIRROR_TARGET).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_ACTIONS_SETTING_BUTTON=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_ACTIONS_SETTING_BUTTON).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_SINGLE_CARD=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_SINGLE_CARD).innerHTML,DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_MODULE=document.getElementById(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_MODULE).innerHTML,DDK.OptionsUICaptain.DynamicValue.botApp=$("."+DDK.OptionsUICaptain.ConstantStatic.MODULE_WRAPPER_CLASS_NAME)[0],DDK.OptionsUICaptain.DynamicValue.FancyCardsModuleReady=!1,DDK.OptionsUICaptain.DynamicValue.ImageCardsModuleReady=!1,DDK.OptionsUICaptain.DynamicValue.ImageModuleReady=!1,DDK.OptionsUICaptain.DynamicValue.TextModuleReady=!1},reCall:function(){DDK.OptionsUICaptain.DynamicValue.botApp=null,DDK.OptionsUICaptain.DynamicValue.FancyCardsModuleReady=null,DDK.OptionsUICaptain.DynamicValue.ImageCardsModuleReady=null,DDK.OptionsUICaptain.DynamicValue.ImageModuleReady=null,DDK.OptionsUICaptain.DynamicValue.TextModuleReady=null},switchModule:function(a){1==$(DDK.OptionsUICaptain.DynamicValue.botApp).hasClass("off")&&$(DDK.OptionsUICaptain.DynamicValue.botApp).removeClass("off");var t=$(DDK.OptionsUICaptain.DynamicValue.botApp).find(">section."+a)[0];switch(a){case"FancyCardsModule":if(0==DDK.OptionsUICaptain.DynamicValue.FancyCardsModuleReady){DDK.OptionsUICaptain.activeDesignerFancyCardsModule(t);for(var e=[['.numbersCount.cards input[type="radio"]',DDK.OptionsUICaptain.cardsNumberSelection],['.numbersCount.thumb input[type="radio"]',DDK.OptionsUICaptain.fancyCardsEnableThumbnail],['.numbersCount.title input[type="radio"]',DDK.OptionsUICaptain.fancyCardsEnableTitle],['.numbersCount.actions input[type="radio"]',DDK.OptionsUICaptain.fancyCardsSetActionButtonNumbers],['.fancyCardsBubble .propsWrapper .actionsGroup input[type="radio"]',DDK.OptionsUICaptain.fancyCardsSwitchActionType]],n=0;n<e.length;n++)FxAddEventListener($(t).find(e[n][0]),DDK.Mutual.EventType.ConstantStatic.RADIO_CHANGE,e[n][1],!1);DDK.OptionsUICaptain.DynamicValue.FancyCardsModuleReady=!0}break;case"ImageCardsModule":0==DDK.OptionsUICaptain.DynamicValue.ImageCardsModuleReady&&(DDK.OptionsUICaptain.activeDesignerImageCardsModule(t),FxAddEventListener($(t).find('.numbersCount input[type="radio"]'),DDK.Mutual.EventType.ConstantStatic.RADIO_CHANGE,DDK.OptionsUICaptain.cardsNumberSelection,!1),DDK.OptionsUICaptain.DynamicValue.ImageCardsModuleReady=!0);break;case"ImageModule":0==DDK.OptionsUICaptain.DynamicValue.ImageModuleReady&&(DDK.OptionsUICaptain.activeDesignerImageModule(t),DDK.OptionsUICaptain.DynamicValue.ImageModuleReady=!0);break;case"TextModule":0==DDK.OptionsUICaptain.DynamicValue.TextModuleReady&&(DDK.OptionsUICaptain.activeDesignerTextModule(t),DDK.OptionsUICaptain.DynamicValue.TextModuleReady=!0)}for(e=$(DDK.OptionsUICaptain.DynamicValue.botApp).find(">section"),n=0;n<e.length;n++)1==$(e[n]).hasClass(a)?$(e[n]).attr("data-io","1").removeClass("off"):$(e[n]).attr("data-io","0").addClass("off")},activeDesignerTextModule:function(a){$(a).append(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_TEXT_MODULE),DDK.ModuleKit.TextModule.init($(a).find("textarea[data-mirror-target]")),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorFancyText($(a).find("textarea[data-mirror-target]")))},activeDesignerImageModule:function(a){$(a).append(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_MODULE),DDK.ModuleKit.ImageModule.init($(a).find("#ImageModule-solo-image-file")),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorImagePreview($(a).find("#ImageModule-solo-image-file")))},activeDesignerImageCardsModule:function(a){for(var t=DDK.OptionsUICaptain.ConstantStatic.IMAGE_CARDS_NUMBERS_COUNTS,e="",n="",i="",r=0;r<t;r++)0==r?(e+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_NUMBERS_BTN,[{_pattern:"##checked##",_fill:"checked"},{_pattern:"##serialValue1~10##",_fill:r+1}]),n+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_SINGLE_CARD,[{_pattern:"##0|1##",_fill:1},{_pattern:"##serialValue0~9##",_fill:r},{_pattern:"##cardSerialValue0~9##",_fill:r}])):(e+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_NUMBERS_BTN,[{_pattern:"##checked##",_fill:""},{_pattern:"##serialValue1~10##",_fill:r+1}]),n+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_SINGLE_CARD,[{_pattern:"##0|1##",_fill:0},{_pattern:"##serialValue0~9##",_fill:r},{_pattern:"##cardSerialValue0~9##",_fill:r+" off"}]));i+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_IMAGE_CARDS_MODULE,[{_pattern:"##numbersButton##",_fill:e},{_pattern:"##singleCard##",_fill:n}]),$(a).append(i),DDK.ModuleKit.ImageCardsModule.init($(a).find("[data-scope]"));for(r=0;r<t;r++)DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorImagePreview($(a).find("#ImageCardsModule-columns-"+r+"-file"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(".imageCardsBubble.count"+r+" .propsWrapper .actionsGroup .uriLabel"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorUriData($(".imageCardsBubble.count"+r+" .propsWrapper .actionsGroup .uriData")))},activeDesignerFancyCardsModule:function(a){for(var t=DDK.OptionsUICaptain.ConstantStatic.FANCY_CARDS_NUMBERS_COUNTS,e="",n=DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_OPTIONS_BTN,i=[],r=[],o="",l="",s=0;s<3;s++)i.push(FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_ACTIONS_MIRROR_TARGET,[{_pattern:"##serialValue0~2##",_fill:s}])),r.push(FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_ACTIONS_SETTING_BUTTON,[{_pattern:"##serialValue0~2##",_fill:s},{_pattern:"##serialValue1~3##",_fill:s+1}]));for(s=0;s<t;s++)o=0==s?(e+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_NUMBERS_BTN,[{_pattern:"##checked##",_fill:"checked"},{_pattern:"##serialValue1~10##",_fill:s+1}]),o+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_SINGLE_CARD,[{_pattern:"##0|1##",_fill:1},{_pattern:"##fancyCardsActions1MirrorTarget##",_fill:i[0]},{_pattern:"##fancyCardsActions2MirrorTarget##",_fill:i[1]},{_pattern:"##fancyCardsActions3MirrorTarget##",_fill:i[2]},{_pattern:"##fancyCardsActions1ButtonOptions##",_fill:r[0]},{_pattern:"##fancyCardsActions2ButtonOptions##",_fill:r[1]},{_pattern:"##fancyCardsActions3ButtonOptions##",_fill:r[2]}]),FxReplace(o,[{_pattern:"##serialValue0~9##",_fill:s},{_pattern:"##cardSerialValue0~9##",_fill:s}])):(e+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_NUMBERS_BTN,[{_pattern:"##checked##",_fill:""},{_pattern:"##serialValue1~10##",_fill:s+1}]),o+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_SINGLE_CARD,[{_pattern:"##0|1##",_fill:0},{_pattern:"##fancyCardsActions1MirrorTarget##",_fill:i[0]},{_pattern:"##fancyCardsActions2MirrorTarget##",_fill:i[1]},{_pattern:"##fancyCardsActions3MirrorTarget##",_fill:i[2]},{_pattern:"##fancyCardsActions1ButtonOptions##",_fill:r[0]},{_pattern:"##fancyCardsActions2ButtonOptions##",_fill:r[1]},{_pattern:"##fancyCardsActions3ButtonOptions##",_fill:r[2]}]),FxReplace(o,[{_pattern:"##serialValue0~9##",_fill:s},{_pattern:"##cardSerialValue0~9##",_fill:s+" off"}]));l+=FxReplace(DDK.OptionsUICaptain.ConstantStatic.TEMPLATE_FANCY_CARDS_MODULE,[{_pattern:"##numbersButton##",_fill:e},{_pattern:"##optionsButton##",_fill:n},{_pattern:"##singleCard##",_fill:o}]),$(a).append(l),DDK.ModuleKit.FancyCardsModule.init($(a).find("[data-scope]"));for(s=0;s<t;s++){DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorImagePreview($(a).find("#FancyCardsModule-columns-"+s+"-image-file"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .mainTitle"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .subTitle")));for(var u=0;u<3;u++)DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .actionsGroup.count"+u+" .labelText"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .actionsGroup.count"+u+" .uriLabel"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorUriData($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .actionsGroup.count"+u+" .uriData"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .actionsGroup.count"+u+" .textDataLabel"))),DDK.Mutual.SyncTask.addTask(DDK.Equalizer.mirrorText($(a).find(".fancyCardsBubble.count"+s+" .propsWrapper .actionsGroup.count"+u+" .textData")))}},cardsNumberSelection:function(a){for(var t=a.currentTarget,e=Number(t.value),n=$(t).closest("section").find(".basicBubble"),i=0;i<n.length;i++)i<e?1==$(n[i]).hasClass("off")&&($(n[i]).removeClass("off"),$(n[i]).find(".propsWrapper").attr("data-io",1)):(0==$(n[i]).hasClass("off")&&$(n[i]).addClass("off"),$(n[i]).find(".propsWrapper").attr("data-io",0))},fancyCardsEnableThumbnail:function(a){var t=a.currentTarget,e=$(t).closest("section"),n=Boolean(Number(t.value)),i=$(e).find(".fancyCardsBubble .propsWrapper .labelBtn.uploadFile"),r=$(e).find('.fancyCardsBubble .propsWrapper input[type="file"]'),o=$(e).find(".fancyCardsBubble .fancyCardsMask"),l=$(e).find(".fancyCardsBubble .textCard");1==n?(i.removeClass("off"),o.removeClass("off"),r.attr("data-io","1"),l.removeClass("onHead")):(i.addClass("off"),o.addClass("off"),r.attr("data-io","0"),l.addClass("onHead"))},fancyCardsEnableTitle:function(a){var t=a.currentTarget,e=$(t).closest("section"),n=Boolean(Number(t.value)),i=$(e).find(".fancyCardsBubble .propsWrapper .mainTitle");1==n?i.each(function(){$(this).removeClass("off").attr("data-io","1"),$(document.getElementById($(this).attr("data-mirror-target"))).removeClass("off")}):i.each(function(){$(this).addClass("off").attr("data-io","0"),$(document.getElementById($(this).attr("data-mirror-target"))).addClass("off")})},fancyCardsSetActionButtonNumbers:function(a){for(var t=a.currentTarget,e=$(t).closest("section"),n=Number(t.value),i=$(e).find(".fancyCardsBubble .actionsCard"),r=0;r<3;r++)r<n?($(e).find(".fancyCardsBubble .propsWrapper .actionsGroup.count"+r).removeClass("off").attr("data-io","1"),i.each(function(){$(this).find("li").eq(r).removeClass("off")})):($(e).find(".fancyCardsBubble .propsWrapper .actionsGroup.count"+r).addClass("off").attr("data-io","0"),i.each(function(){$(this).find("li").eq(r).addClass("off")}))},fancyCardsSwitchActionType:function(a){var t=a.currentTarget,e=$(t).closest(".fancyCardsBubble"),n=$(t).closest(".actionsGroup"),i=$(n).attr("class");i=Number(i.charAt(i.length-1));var r=$(e).find(".actionsCard li").eq(i),o=t.value;"message"==o?(n.find("input.labelText , input.labelTextData").removeClass("off").attr("data-io","1"),n.find("input.uriLabel , input.uriData").addClass("off").attr("data-io","0"),n.find("input.textDataLabel , input.textData").addClass("off").attr("data-io","0"),r.find(".message").removeClass("off"),r.find(".uri , .postback").addClass("off")):"uri"==o?(n.find("input.uriLabel , input.uriData").removeClass("off").attr("data-io","1"),n.find("input.labelText , input.labelTextData").addClass("off").attr("data-io","0"),n.find("input.textDataLabel , input.textData").addClass("off").attr("data-io","0"),r.find(".uri").removeClass("off"),r.find(".message , .postback").addClass("off")):"postback"==o&&(n.find("input.textDataLabel , input.textData").removeClass("off").attr("data-io","1"),n.find("input.labelText , input.labelTextData").addClass("off").attr("data-io","0"),n.find("input.uriLabel , input.uriData").addClass("off").attr("data-io","0"),r.find(".postback").removeClass("off"),r.find(".message , .uri").addClass("off"))}},DDK.ModuleKit={ConstantStatic:{},DynamicValue:{activeModuleArray:null,wrapperObserver:null,valueDataObserver:null},init:function(){DDK.ModuleKit.DynamicValue.activeModuleArray=[],DDK.ModuleKit.DynamicValue.wrapperObserver=new MutationObserver(DDK.ModuleKit.watchWrapperAttributes),DDK.ModuleKit.DynamicValue.valueDataObserver=new MutationObserver(DDK.ModuleKit.watchValueInputAttributes),DDK.ModuleKit.TextModule.watchIOstate=DDK.ModuleKit.watchIOstate,DDK.ModuleKit.ImageModule.watchIOstate=DDK.ModuleKit.watchIOstate,DDK.ModuleKit.ImageCardsModule.watchIOstate=DDK.ModuleKit.watchIOstate,DDK.ModuleKit.FancyCardsModule.watchIOstate=DDK.ModuleKit.watchIOstate},reCall:function(){DDK.ModuleKit.DynamicValue.activeModuleArray=null,DDK.ModuleKit.DynamicValue.wrapperObserver.disconnect(),DDK.ModuleKit.DynamicValue.wrapperObserver=null,DDK.ModuleKit.DynamicValue.valueDataObserver.disconnect(),DDK.ModuleKit.DynamicValue.valueDataObserver=null;for(var a=0;a<DDK.ModuleKit.DynamicValue.activeModuleArray.length;a++)FxRemoveEachEventListener(DDK.ModuleKit.DynamicValue.activeModuleArray[a]);DDK.ModuleKit.DynamicValue.activeModuleArray=null},fileInputSetTimeStamp:function(a){var t=a.target,e=(new Date).getTime();$(t).attr("alt",e)},executableLinkConfirm:function(a){FxEventObject(a).overwriteDefault();var t=a.currentTarget;1==confirm(DDK.Mutual.TextScript.OPEN_LABEL_URL)&&window.open($(t).attr("href"))},saveAddedEventInstance:function(a){if(null!=a.length&&0<a.length)for(var t=0;t<a.length;t++)DDK.ModuleKit.DynamicValue.activeModuleArray.push(a[t]);null==a.length&&DDK.ModuleKit.DynamicValue.activeModuleArray.push(a)},watchIOstate:function(a){for(var t=$(a).find('[data-scope="node"] , [data-scope="anonymousProps"] , [data-scope="props"]'),e=($(a).find('[data-scope="keyValue"]'),0);e<t.length;e++)DDK.ModuleKit.DynamicValue.wrapperObserver.observe(t[e],{attributes:!0});null!=$(a).attr("data-io")&&DDK.ModuleKit.DynamicValue.wrapperObserver.observe($(a)[0],{attributes:!0})},watchWrapperAttributes:function(a){for(var t,e=0;e<a.length;e++)t=a[e].target,1==Boolean(Number($(t).attr("data-io")))?$(t).removeClass("off").addClass("open"):$(t).removeClass("open").addClass("off")},watchValueInputAttributes:function(a){for(var t=0;t<a.length;t++)a[t].target},TextModule:{init:function(a){},reCall:function(){},watchIOstate:null},ImageModule:{init:function(a){FxAddEventListener(a,"change",DDK.ModuleKit.fileInputSetTimeStamp,!1),DDK.ModuleKit.saveAddedEventInstance(a)},reCall:function(){},watchIOstate:null},ImageCardsModule:{init:function(a){$(a).find("input[data-mirror-target]").each(function(){if(""!=$(this).attr("data-mirror-target")){var a=$(this).attr("data-mirror-type");if("file-image"==a)FxAddEventListener(this,"change",DDK.ModuleKit.fileInputSetTimeStamp,!1),DDK.ModuleKit.saveAddedEventInstance(this);else if("uri-data"==a){var t=document.getElementById($(this).attr("data-mirror-target"));FxAddEventListener(t,"click",DDK.ModuleKit.executableLinkConfirm,!1),DDK.ModuleKit.saveAddedEventInstance(t)}}})},reCall:function(){},watchIOstate:null},FancyCardsModule:{init:function(a){$(a).find("input[data-mirror-target]").each(function(){if(""!=$(this).attr("data-mirror-target")){var a=$(this).attr("data-mirror-type");if("file-image"==a)FxAddEventListener(this,"change",DDK.ModuleKit.fileInputSetTimeStamp,!1),DDK.ModuleKit.saveAddedEventInstance(this);else if("uri-data"==a){var t=document.getElementById($(this).attr("data-mirror-target"));FxAddEventListener(t,"click",DDK.ModuleKit.executableLinkConfirm,!1),DDK.ModuleKit.saveAddedEventInstance(t)}}})},reCall:function(){},watchIOstate:null}},DDK.DataExport={ConstantStatic:{},DynamicValue:{},init:function(){},reCall:function(){},TextModule:{exportJSON:function(a){" "!=a.charAt(a.length-1)&&(a+=" ");var t=DDK.DataExport.TextModule.getPropsData(a+'[data-scope="anonymousProps"][data-io="1"]'),e=JSON.stringify(t);return console.log(t),console.log(e),e},getPropsData:function(a){var t,e,n={type:"text"};return t=$(a).find('>[data-scope="keyValue"][data-io="1"]')[0],n[e=$(t).attr("data-key")]=1==FxHasAttribute(t,"data-uri-marker")?FxReplace(t.value,FxGetAttribute(t,"data-uri-marker"),""):t.value,n[e]=FxReplace(n[e],"\n","\\n"),n}},ImageModule:{exportJSON:function(a){" "!=a.charAt(a.length-1)&&(a+=" ");var t=DDK.DataExport.ImageModule.getPropsData(a+'[data-scope="anonymousProps"][data-io="1"]'),e=JSON.stringify(t);return console.log(t),console.log(e),e},getPropsData:function(a){var t,e,n={type:"image",previewImageUrl:""};return t=$(a).find('>[data-scope="keyValue"][data-io="1"]')[0],e=$(t).attr("data-key"),$(t).attr("type"),n[e]=t.name,n.previewImageUrl=t.name,n}},ImageCardsModule:{exportJSON:function(a){" "!=a.charAt(a.length-1)&&(a+=" ");var t={type:"template",altText:"chiliman push content",template:DDK.DataExport.ImageCardsModule.getColumnsData(a+'[data-key="columns"][data-io="1"]')},e=JSON.stringify(t);return console.log(t),console.log(e),e},getColumnsData:function(a){for(var t,e,n,i,r,o={type:"image_carousel",columns:[]},l=$(a),s=0;s<l.length;s++){t=l[s],n={},e=$(t).find('>[data-scope="keyValue"][data-io="1"]');for(var u=0;u<e.length;u++)i=e[u],r=$(i).attr("data-key"),"file"==$(i).attr("type")&&(n[r]=i.name);e=$(t).find('[data-key="action"][data-io="1"]'),n[r=$(e[0]).attr("data-key")]=DDK.DataExport.ImageCardsModule.getActionData($(e[0]).find('>[data-scope="anonymousProps"][data-io="1"]'))[0],o.columns.push(n)}return o},getActionData:function(a){for(var t,e,n,i=[],r=0;r<a.length;r++)n=a[r],t=$(n).find('[data-scope="keyValue"][data-key="type"]:checked').val(),e={type:String(t),label:String($(n).find('[data-scope="keyValue"][data-key="label"]').val())},"message"==t?e.text=String($(n).find('[data-scope="keyValue"][data-key="text"]').val()):"uri"==t?e.uri=String($(n).find('[data-scope="keyValue"][data-key="uri"]').val()):"postback"==t&&(e.data=$(n).find('[data-scope="keyValue"][data-key="data"]').val(),""!=$(n).find('[data-scope="keyValue"][data-key="text"]').val()&&(e.text=String($(n).find('[data-scope="keyValue"][data-key="text"]').val()))),i.push(e);return i}},FancyCardsModule:{exportJSON:function(a){" "!=a.charAt(a.length-1)&&(a+=" ");var t={type:"template",altText:"chiliman push content",template:DDK.DataExport.FancyCardsModule.getColumnsData(a+'[data-key="columns"][data-io="1"]')},e=JSON.stringify(t);return console.log(t),console.log(e),e},getColumnsData:function(a){for(var t,e,n,i,r,o,l={type:"carousel",actions:[],columns:[]},s=$(a),u=0;u<s.length;u++){t=s[u],n={},e=$(t).find('>[data-scope="keyValue"][data-io="1"]');for(var d=0;d<e.length;d++)i=e[d],r=$(i).attr("data-key"),o=$(i).attr("type"),n[r]="file"==o?i.name:String(i.value);e=$(t).find('[data-key="actions"][data-io="1"]'),n[r=$(e[0]).attr("data-key")]=DDK.DataExport.FancyCardsModule.getActionData($(e[0]).find('>[data-scope="anonymousProps"][data-io="1"]')),l.columns.push(n)}return l},getActionData:function(a){for(var t,e,n,i=[],r=0;r<a.length;r++)n=a[r],t=$(n).find('[data-scope="keyValue"][data-key="type"]:checked').val(),e={type:String(t),label:String($(n).find('[data-scope="keyValue"][data-key="label"][data-io="1"]').val())},"message"==t?e.text=String($(n).find('[data-scope="keyValue"][data-key="text"]').val()):"uri"==t?e.uri=String($(n).find('[data-scope="keyValue"][data-key="uri"]').val()):"postback"==t&&(e.data=$(n).find('[data-scope="keyValue"][data-key="data"]').val(),""!=$(n).find('[data-scope="keyValue"][data-key="text"]').val()&&(e.text=String($(n).find('[data-scope="keyValue"][data-key="text"]').val()))),i.push(e);return i}}},DDK.DataImport={ConstantStatic:{},DynamicValue:{},init:function(){},reCall:function(){},TextModual:{},ImageModual:{},ImageCardsModual:{},FancyCardsModual:{}},DDK.Equalizer={mirrorFancyText:function(r){return{sourceTarget:r[0],sourceRoot:$(r[0]).closest("section[data-io]"),equalFunc:function(){var a=document.getElementById($(r).attr("data-mirror-target")),t=$(r).attr("data-mirror-type"),e=1==FxHasAttribute($(r)[0],"data-uri-marker")?$(r).attr("data-uri-marker"):"",n=$(r).val();if(""!=n){var i=DDK.Equalizer.formatTextContent(n,t,e);$(a).html()!=i&&$(a).empty().html(i)}}}},mirrorText:function(i){return{sourceTarget:i[0],sourceRoot:$(i[0]).closest("section[data-io]"),equalFunc:function(){var a=document.getElementById($(i).attr("data-mirror-target")),t=$(i).attr("data-mirror-type"),e=$(i).val();if(""!=e){var n=DDK.Equalizer.formatTextContent(e,t);$(a).html()!=n&&$(a).empty().append(n)}}}},mirrorUriData:function(e){return{sourceTarget:e[0],sourceRoot:$(e[0]).closest("section[data-io]"),equalFunc:function(){var a=document.getElementById($(e).attr("data-mirror-target")),t=($(e).attr("data-mirror-type"),$(e).val());""!=t&&("a"!=a.tagName.toLowerCase()||""!=t&&$(a).attr("href")!=t&&$(a).attr("href",t))}}},mirrorImagePreview:function(i){return{sourceTarget:i[0],sourceRoot:$(i[0]).closest("section[data-io]"),equalFunc:function(){var a=document.getElementById($(i).attr("data-mirror-target")),t=$(i).attr("data-mirror-type"),e=$(i).attr("alt"),n=$(i)[0].files;0!=n.length&&$(a).attr("alt")!=e&&"file-image"==t&&(DDK.Equalizer.setNewBase64Image(n[0],a),$(a).attr("alt",e))}}},formatTextContent:function(a,t,e){var n;if("fancy-text"==t){var i=[],r=[];(-1<(a=he.escape(a)).indexOf("http://")||-1<a.indexOf("https://"))&&(-1<a.indexOf("http://")&&(i=DDK.Equalizer.packageHyperText("http://",a,e)),-1<a.indexOf("https://")&&(r=DDK.Equalizer.packageHyperText("https://",a,e)));var o=[{_pattern:"\n",_fill:"<br>",_mode:"all"}].concat(i,r);n=FxReplace(a,o)}else"text"!=t&&"label-text"!=t||(n=he.escape(a));return n},packageHyperText:function(a,t,e){for(var n,i,r=t.split(a).length-1,o=0,l=0,s=[],u=he.escape(DDK.Mutual.TextScript.OPEN_LABEL_URL),d=0;d<r;d++)l=t.indexOf(a,o),o=t.indexOf(e,l)+e.length,i=(n=t.substring(l,o)).substring(0,n.length-e.length),s.push({_pattern:n,_fill:'<a href="javascript:;" onclick="var r = confirm(\''+u+"');if(r == true) window.open('"+i+"');void(0);\">"+i+"</a>",_mode:"first"});return s},setNewBase64Image:function(a,e){var t=new FileReader;FxAddEventListener(t,"load",function(a){var t=a.target.result;e.src=t,DDK.Equalizer.setImageAlign(e.parentElement.tagName,e)},!1),t.readAsDataURL(a)},setImageAlign:function(e,n){$(n).removeClass("animated").removeClass("flipInY").removeClass("flipInX"),$(n).closest(e).removeClass("portraitSize").removeClass("landscapeSize"),FxCheckMultiImgLoad({img_ary:[n],interval:"load",update:!0,delay:50,eachEnd:function(a,t){$(a).removeAttr("style").addClass("animated"),a.clientWidth>=a.clientHeight?($(n).closest(e).addClass("landscapeSize"),$(a).addClass("flipInX")):($(n).closest(e).addClass("portraitSize"),$(a).addClass("flipInY"))},end:function(a,t){FxFotoCaption({imageList:a,update:!0,contenter:e,formatter:"shrink"})}})()}};